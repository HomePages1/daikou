<!--


document.getElementById('leadForm').addEventListener('submit', async (e)=>{
e.preventDefault();
noticeEl.innerHTML = '';


const data = {
name: document.getElementById('name').value.trim(),
email: document.getElementById('email').value.trim(),
phone: document.getElementById('phone').value.trim(),
company: document.getElementById('company').value.trim(),
service: document.getElementById('service').value,
message: document.getElementById('message').value.trim(),
source: window.location.href,
created_at: new Date().toISOString()
};


if(!data.name || !data.email){
showNotice('err','お名前とメールは必須です');
return;
}


// Try to post to API endpoint
try{
const res = await fetch(API_ENDPOINT, {
method:'POST',
headers:{'Content-Type':'application/json'},
body: JSON.stringify(data)
});


if(res.ok){
showNotice('ok','送信しました！24時間以内にご連絡します。');
document.getElementById('leadForm').reset();
} else {
const text = await res.text();
// If the endpoint is not configured, give friendly fallback
showNotice('err','送信に失敗しました（サーバーエラー）。管理者にお問い合せください。');
console.error('Server error', text);
}
}catch(err){
console.warn('primary endpoint failed', err);
// Optional: try direct insert to Supabase if configured
if(SUPABASE_URL && SUPABASE_KEY){
try{
await supabaseInsert(data);
showNotice('ok','送信しました！（Supabase経由）');
document.getElementById('leadForm').reset();
return;
}catch(e){
console.error('supabase failed', e);
}
}
showNotice('err','送信に失敗しました。ネットワーク設定やエンドポイントを確認してください。');
}
});


// Optional Supabase insert (client-side). Uncomment to enable and include SUPABASE_URL/KEY.
async function supabaseInsert(row){
if(!SUPABASE_URL || !SUPABASE_KEY) throw new Error('Supabase not configured');
const url = SUPABASE_URL + '/rest/v1/leads'; // assumes a table named 'leads'
const res = await fetch(url,{
method:'POST',
headers:{
'Content-Type':'application/json',
'apikey': SUPABASE_KEY,
'Authorization': 'Bearer ' + SUPABASE_KEY
},
body: JSON.stringify(row)
});
if(!res.ok) throw new Error('Supabase insert failed');
return res.json();
}


</script>
</body>
</html>